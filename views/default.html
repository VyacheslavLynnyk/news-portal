<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title><?=Config::get('site_name')?></title>
    <link rel="stylesheet" href="<?=REL_URL?>/css/normalize.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
          integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css"
          integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
    <link rel="stylesheet" href="<?=REL_URL?>/css/main.css">
    <link rel="stylesheet" href="<?=REL_URL?>/css/adds-css.css">
    <link rel="stylesheet" href="<?=REL_URL?>/css/pagination.css">


    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="<?=REL_URL?>/css/dynamic-edit.css">

    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>-->
    <script src="<?=REL_URL?>/js/jquery.min.js"></script>
    <script src="<?=REL_URL?>/js/jquery-ui.min.js"></script>
<!--    <script src="--><?//=REL_URL?><!--/js/jquery.simplemodal.js"></script>-->
<!--    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>-->
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]>
    <script src="<?=REL_URL?>/js/ie8-responsive-file-warning.js"></script>
    <![endif]-->
    <script src="<?=REL_URL?>/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->


    <script src="<?=REL_URL?>/js/init.js"></script>
    <script src="<?=REL_URL?>/js/ie10-viewport-bug-workaround.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
            integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script src="<?=REL_URL?>/js/main-js.js"></script>
    <script src="<?=REL_URL?>/js/jscolor.min.js"></script>
    <script src="<?=REL_URL?>/js/load-avatar.js"></script>

</head>

<body>
    <div id="header--nav" class="blog-masthead">
        <div class="container">
            <nav class="blog-nav">
                <?=Html::a_is_active('news', 'News',['blog-nav-item'])?>

                <div class="dropdown blog-nav-item">
                    <a role="button" data-toggle="dropdown"  data-target="#" href="/page.html">
                        Меню <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu multi-level" role="menu" aria-labelledby="dropdownMenu">
                        <li><a href="#">одним</a></li>
                        <li><a href="#">из пунктов</a></li>
                        <li><a href="#">которого</a></li>
                        <li class="divider"></li>
                        <li class="dropdown-submenu">
                            <a tabindex="-1" href="#">выпадающий список</a>
                            <ul class="dropdown-menu">
                                <li><a tabindex="-1" href="#">внутри</a></li>
                                <li><a tabindex="-1" href="#">которого</a></li>
                                <li><a tabindex="-1" href="#">одним из пунктов</a></li>
                                <li class="dropdown-submenu">
                                    <a href="#">еще один</a>
                                    <ul class="dropdown-menu">
                                        <li><a href="#">выпадающий</a></li>
                                        <li><a href="#">список</a></li>
                                    </ul>
                                </li>
                                <li><a href="#">:)</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>

                <div class="navbar-form navbar-right">
                    <input type="text" class="form-control searcher" placeholder="Search...">
                </div>

                    <?php $user = Auth::getLogin(); ?>

                    <?php if ($user != null) {
                        $role = Auth::getRole();
                        if (isset($role) && $role == 'admin') {
                            echo Html::a_is_active('manager', 'Manager', ['blog-nav-item']);
                        }
                        echo Html::a_is_active('auth/logout', Auth::getLogin().' (Выйти)',['blog-nav-item pull-right']);
                    } else {
                        echo Html::a_is_active('auth/index', '(Вход)',['blog-nav-item pull-right']);
                } ?>

            </nav>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="subscribe" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Подписаться на рассылку</h4>
                </div>
                <div class="modal-body">
                    <form class="form-inline">
                        <div class="form-group">
                            <label>Ваше Имя:</label>
                            <input type="text" class="form-control"  placeholder="Вася">
                        </div>
                        <div class="form-group">
                            <label>Ваш Email:</label>
                            <input type="email" class="form-control" placeholder="jane.doe@example.com">
                        </div>
                        <div class="form-group">
                            <div class="page-header">
                                <button type="submit" class="btn btn-success">Подписаться</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>

    <div id="news-content" class="container">
        <?= $data['content'] ?>
    </div>

    <script>
        setTimeout(function () {
            $('#subscribe').modal('show');
        }, 15000);

        function searchByTagsId(content, tags)
        {
            $.get("<?= REL_URL.'/news/search-by-tags-id'?>" + tags,
                function (data) {
                    content.empty();
                    content.prepend(data);
                });
        };

        function searcher(request, response)
        {
            $.get("<?= REL_URL.'/news/search-by-tag-name/'?>" + request.term,
                function (data) {
                    var content = $("#news-content");
                    if (data == '') {
                        var content = $("#news-content");
                        content.empty();
                        content.prepend('<h2> Не найдено результатов по запросу </h2>');
                        return 0;
                    }
                    var getData = $.parseJSON(data);
                    var tags = '';
                    $.each( getData, function( tagId, value ) {
                        tags += "/" + tagId;
                    });
                    searchByTagsId(content, tags);
                    // I don't know yet why? But must be :) (to resolve function error)
                    if (typeof response === "function") {
                        response(getData);
                    }
                });
        };

        $("input.searcher").autocomplete({
            delay: 400,
            source: searcher,
            // Action on select
            select: function(event, ui) {
                var request = {};
                request.term = ui.item.value;
                searcher(request);
            }
        });


    </script>
</body>
</html>